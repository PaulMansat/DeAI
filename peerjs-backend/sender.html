<html>
  <body>
<div>
<input type="text" placeholder="Username" id="username">
<button onclick="register()">Register</button>
</div>

<div>
<input type="text" placeholder="Receiver" id="receiver">
<button onclick="send()">Send</button>
</div>



<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
<script src="https://rawgit.com/kawanet/msgpack-lite/master/dist/msgpack.min.js"></script>
<script src="./modelbuilder.js"></script>
<script src="./peer.js"></script>
<script src="./helpers.js"></script>

<script>
console.log('start')


const model = tf.sequential();
model.add(tf.layers.dense({units: 32, inputShape: [50]}));
model.add(tf.layers.dense({units: 4}));

const model_compile_data = {
  optimizer   : 'sgd',
  loss        : 'categoricalCrossentropy',
  metrics     : ['accuracy']
}

const model_train_data = {
  epochs  : 5
}

var peerjs = null
recv_buffer = {}

function register() {
  const username = document.getElementById("username").value

  peer = new Peer(username, {host: 'localhost', port: 9000, path: '/myapp'})
  peerjs = new PeerJS(peer, handle_data, recv_buffer)

}

// for random string
function makeid(length) {
   var result           = '';
   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
   var charactersLength = characters.length;
   for ( var i = 0; i < length; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
   }
   return result;
}


async function send() {
    const receiver = document.getElementById("receiver").value
    var name = makeid(10)
    await send_model(model, peerjs, receiver, name)
    await send_data(model_compile_data, CMD_CODES.COMPILE_MODEL, peerjs, receiver)
    await send_data(model_train_data, CMD_CODES.TRAIN_INFO, peerjs, receiver)
}


</script>
  </body>
</html>
